$(window).on("load",function(){var u=d3.dispatch("load","statechange"),p=d3.select("#disptach-events"),d=["Under 5 Years","5 to 13 Years","14 to 17 Years","18 to 24 Years","25 to 44 Years","45 to 64 Years","65 Years and Over"];d3.csv("../../../app-assets/data/d3/pie/dispatch-events.csv",function(a){return a.total=d3.sum(d,function(t){return a[t]=+a[t]}),a},function(t,a){if(t)throw t;var n=d3.map();a.forEach(function(t){n.set(t.id,t)}),u.load(n),u.statechange(n.get("CA"))}),u.on("load.menu",function(t){var a=p.append("div").append("select").on("change",function(){u.statechange(t.get(this.value))});a.selectAll("option").data(t.values()).enter().append("option").attr("value",function(t){return t.id}).text(function(t){return t.id}),u.on("statechange.menu",function(t){a.property("value",t.id)})}),u.on("load.bar",function(t){var a=20,n=20,e=30,r=40,i=80-r-n,o=460-a-e,d=d3.scale.linear().domain([0,d3.max(t.values(),function(t){return t.total})]).rangeRound([o,0]).nice(),s=d3.svg.axis().scale(d).orient("left").tickFormat(d3.format(".2s")),c=p.append("svg").attr("width",i+r+n).attr("height",o+a+e).append("g").attr("transform","translate("+r+","+a+")");c.append("g").attr("class","y axis").call(s);var l=c.append("rect").attr("x",4).attr("width",i-4).attr("y",o).attr("height",0).style("fill","#aaa");u.on("statechange.bar",function(t){l.transition().attr("y",d(t.total)).attr("height",d(0)-d(t.total))})}),u.on("load.pie",function(t){var a=p.node().getBoundingClientRect().width-100,n=Math.min(a,460)/2,e=d3.scale.ordinal().domain(d).range(["#99B898","#FECEA8","#FF847C","#E84A5F","#F8B195","#F67280","#C06C84"]),r=d3.svg.arc().outerRadius(n-10).innerRadius(n-70),i=d3.layout.pie().sort(null),o=p.append("svg").attr("width",a).attr("height",460).append("g").attr("transform","translate("+a/2+",230)").selectAll("path").data(d).enter().append("path").style("fill",e).each(function(){this._current={startAngle:0,endAngle:0}});u.on("statechange.pie",function(a){o.data(i.value(function(t){return a[t]})(d)).transition().attrTween("d",function(t){var a=d3.interpolate(this._current,t);return this._current=a(0),function(t){return r(a(t))}})})})});