$(window).on("load",function(){var t=d3.select("#stacked-to-grouped"),n=20,a=20,r=30,e=50,i=t.node().getBoundingClientRect().width-e-a,o=500-n-r,d=4,u=d3.layout.stack()(d3.range(d).map(function(){return function(o,t){function n(t){for(var n=1/(.1+Math.random()),a=2*Math.random()-.5,r=10/(.1+Math.random()),e=0;e<o;e++){var i=(e/o-a)*r;t[e]+=n*Math.exp(-i*i)}}var a,r=[];for(a=0;a<o;++a)r[a]=t+t*Math.random();for(a=0;a<5;++a)n(r);return r.map(function(t,n){return{x:n,y:Math.max(0,t)}})}(58,.1)})),c=d3.max(u,function(t){return d3.max(t,function(t){return t.y})}),l=d3.max(u,function(t){return d3.max(t,function(t){return t.y0+t.y})}),s=d3.scale.ordinal().domain(d3.range(58)).rangeRoundBands([0,i],.08),f=d3.scale.linear().domain([0,l]).range([o,0]),g=d3.scale.linear().domain([0,d-1]).range(["#FECEA8","#E84A5F"]),h=d3.svg.axis().scale(s).tickSize(0).tickPadding(6).orient("bottom"),y=t.append("svg"),m=y.attr("width",i+e+a).attr("height",o+n+r).append("g").attr("transform","translate("+e+","+n+")"),x=m.selectAll(".layer").data(u).enter().append("g").attr("class","layer").style("fill",function(t,n){return g(n)}).selectAll(".d3-bar").data(function(t){return t}).enter().append("rect").attr("class","d3-bar").attr("x",function(t){return s(t.x)}).attr("y",o).attr("width",s.rangeBand()).attr("height",0);x.transition().delay(function(t,n){return 10*n}).attr("y",function(t){return f(t.y0+t.y)}).attr("height",function(t){return f(t.y0)-f(t.y0+t.y)}),m.append("g").attr("class","d3-axis d3-xaxis").attr("transform","translate(0,"+o+")").call(h),d3.selectAll("input").on("change",w);var p=setTimeout(function(){d3.select('input[value="grouped"]').property("checked",!0).each(w)},2e3);function w(){clearTimeout(p),"grouped"===this.value?(f.domain([0,c]),x.transition().duration(500).delay(function(t,n){return 10*n}).attr("x",function(t,n,a){return s(t.x)+s.rangeBand()/d*a}).attr("width",s.rangeBand()/d).transition().attr("y",function(t){return f(t.y)}).attr("height",function(t){return o-f(t.y)})):(f.domain([0,l]),x.transition().duration(500).delay(function(t,n){return 10*n}).attr("y",function(t){return f(t.y0+t.y)}).attr("height",function(t){return f(t.y0)-f(t.y0+t.y)}).transition().attr("x",function(t){return s(t.x)}).attr("width",s.rangeBand()))}function v(){i=t.node().getBoundingClientRect().width-e-a,y.attr("width",i+e+a),m.attr("width",i+e+a),s.rangeRoundBands([0,i],.08),m.selectAll(".d3-xaxis").call(h),m.selectAll(".d3-bar").attr("x",function(t){return s(t.x)})}$(window).on("resize",v),$(".menu-toggle").on("click",v)});