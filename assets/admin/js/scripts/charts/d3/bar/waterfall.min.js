$(window).on("load",function(){var t=d3.select("#waterfall"),a=20,n=20,e=30,r=50,d=t.node().getBoundingClientRect().width-r-n,l=500-a-e;padding=.3;var s=d3.scale.ordinal().rangeRoundBands([0,d],padding),i=d3.scale.linear().range([l,0]),o=d3.svg.axis().scale(s).orient("bottom"),c=d3.svg.axis().scale(i).orient("left").tickFormat(function(t){return f(t)}),u=t.append("svg"),g=u.attr("width",d+r+n).attr("height",l+a+e).append("g").attr("transform","translate("+r+","+a+")");function f(t){var a=t=Math.round(t);return 1e3<Math.abs(t)&&(a=Math.round(t/1e3)+"K"),"$"+a}function p(){d=t.node().getBoundingClientRect().width-r-n,u.attr("width",d+r+n),g.attr("width",d+r+n),s.rangeRoundBands([0,d],padding),g.selectAll(".d3-xaxis").call(o),g.selectAll(".d3-bar").attr("transform",function(t){return"translate("+s(t.name)+",0)"}),g.selectAll(".d3-bar rect").attr("width",s.rangeBand()),g.selectAll(".d3-bar text").attr("x",s.rangeBand()/2),g.selectAll(".d3-connector").attr("x1",s.rangeBand()+5).attr("x2",s.rangeBand()/(1-padding)-5)}d3.csv("../../../app-assets/data/d3/bar/waterfall.csv",function(t){return t.value=+t.value,t},function(t,a){if(t)throw t;for(var n=0,e=0;e<a.length;e++)a[e].start=n,n+=a[e].value,a[e].end=n,a[e].class=0<=a[e].value?"positive":"negative";a.push({name:"Total",end:n,start:0,class:"total"}),s.domain(a.map(function(t){return t.name})),i.domain([0,d3.max(a,function(t){return t.end})]),g.append("g").attr("class","d3-axis d3-xaxis").attr("transform","translate(0,"+l+")").call(o),g.append("g").attr("class","d3-axis d3-yaxis").call(c);var r=g.selectAll(".d3-bar").data(a).enter().append("g").attr("class",function(t){return"d3-bar "+t.class}).attr("transform",function(t){return"translate("+s(t.name)+",0)"});r.append("rect").attr("y",function(t){return i(Math.max(t.start,t.end))}).attr("height",function(t){return Math.abs(i(t.start)-i(t.end))}).attr("width",s.rangeBand()),r.append("text").attr("x",s.rangeBand()/2).attr("y",function(t){return i(t.end)+5}).attr("dy",function(t){return("negative"==t.class?"-":"")+".75em"}).text(function(t){return f(t.end-t.start)}),r.filter(function(t){return"total"!=t.class}).append("line").attr("class","d3-connector").attr("x1",s.rangeBand()+5).attr("y1",function(t){return i(t.end)}).attr("x2",s.rangeBand()/(1-padding)-5).attr("y2",function(t){return i(t.end)})}),$(window).on("resize",p),$(".menu-toggle").on("click",p)});