$(window).on("load",function(){var d=d3.select("#sunburst-sequence"),i=d.node().getBoundingClientRect().width,l=Math.min(i,400)/2,o={w:75,h:30,s:3,t:10},c={home:"#99B898",product:"#FECEA8",search:"#FF847C",account:"#E84A5F",other:"#6C5B7B",end:"#355C7D"},u=0,h=d.append("svg:svg").attr("width",i).attr("height",400).append("svg:g").attr("id","container").attr("transform","translate("+i/2+",200)"),s=d3.layout.partition().size([2*Math.PI,l*l]).value(function(t){return t.size}),p=d3.svg.arc().startAngle(function(t){return t.x}).endAngle(function(t){return t.x+t.dx}).innerRadius(function(t){return Math.sqrt(t.y)}).outerRadius(function(t){return Math.sqrt(t.y+t.dy)});function v(t){var e=(100*t.value/u).toPrecision(3),n=e+"%";e<.1&&(n="< 0.1%"),d3.select("#percentage").text(n),d3.select("#explanation").style("visibility","");var r,a,i,l,s=function(t){var e=[],n=t;for(;n.parent;)e.unshift(n),n=n.parent;return e}(t);r=s,a=n,i=d3.select("#trail").selectAll("g").data(r,function(t){return t.name+t.depth}),(l=i.enter().append("svg:g")).append("svg:polygon").attr("points",g).style("fill",function(t){return c[t.name]}),l.append("svg:text").attr("x",(o.w+o.t)/2).attr("y",o.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(t){return t.name}),i.attr("transform",function(t,e){return"translate("+e*(o.w+o.s)+", 0)"}),i.exit().remove(),d3.select("#trail").select("#endlabel").attr("x",(r.length+.5)*(o.w+o.s)).attr("y",o.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(a),d3.select("#trail").style("visibility",""),d.selectAll("path").style("opacity",.3),h.selectAll("path").filter(function(t){return 0<=s.indexOf(t)}).style("opacity",1)}function f(t){d3.select("#trail").style("visibility","hidden"),d.selectAll("path").on("mouseover",null),d.selectAll("path").transition().duration(1e3).style("opacity",1).each("end",function(){d3.select(this).on("mouseover",v)}),d3.select("#explanation").style("visibility","hidden")}function g(t,e){var n=[];return n.push("0,0"),n.push(o.w+",0"),n.push(o.w+o.t+","+o.h/2),n.push(o.w+","+o.h),n.push("0,"+o.h),0<e&&n.push(o.t+","+o.h/2),n.join(" ")}function y(){var t=d3.select("#legend");"hidden"==t.style("visibility")?t.style("visibility",""):t.style("visibility","hidden")}d3.text("../../../app-assets/data/d3/circle/visit-sequences.csv",function(t){!function(t){d3.select("#sequence").append("svg:svg").attr("width",i).attr("height",50).attr("id","trail").append("svg:text").attr("id","endlabel").style("fill","#000"),n={w:75,h:30,s:3,r:3},e=d3.select("#legend").append("svg:svg").attr("width",n.w).attr("height",d3.keys(c).length*(n.h+n.s)).selectAll("g").data(d3.entries(c)).enter().append("svg:g").attr("transform",function(t,e){return"translate(0,"+e*(n.h+n.s)+")"}),e.append("svg:rect").attr("rx",n.r).attr("ry",n.r).attr("width",n.w).attr("height",n.h).style("fill",function(t){return t.value}),e.append("svg:text").attr("x",n.w/2).attr("y",n.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(t){return t.key}),d3.select("#togglelegend").on("click",y),h.append("svg:circle").attr("r",l).style("opacity",0);var n,e;var r=s.nodes(t).filter(function(t){return.005<t.dx}),a=h.data([t]).selectAll("path").data(r).enter().append("svg:path").attr("display",function(t){return t.depth?null:"none"}).attr("d",p).attr("fill-rule","evenodd").style("fill",function(t){return c[t.name]}).style("opacity",1).on("mouseover",v);d3.select("#container").on("mouseleave",f),u=a.node().__data__.value}(function(t){for(var e={name:"root",children:[]},n=0;n<t.length;n++){var r=t[n][0],a=+t[n][1];if(!isNaN(a))for(var i=r.split("-"),l=e,s=0;s<i.length;s++){var d,o=l.children,c=i[s];if(s+1<i.length){for(var u=!1,h=0;h<o.length;h++)if(o[h].name==c){d=o[h],u=!0;break}u||(d={name:c,children:[]},o.push(d)),l=d}else d={name:c,size:a},o.push(d)}}return e}(d3.csv.parseRows(t)))})});